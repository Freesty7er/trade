&НаСервере
Процедура УстановитьМаршрут(Знач ДанныеДляОбработки, ЗначениеМаршрутРазвоза)
	
	//ЗначениеМаршрутРазвоза = Неопределено;
	
	Если ДанныеДляОбработки <> Неопределено Тогда
		
		Для Каждого ТекущиеДанные Из ДанныеДляОбработки Цикл
			Если ЗначениеЗаполнено(ТекущиеДанные) И (НЕ ТекущиеДанные.МаршрутРазвоза = ЗначениеМаршрутРазвоза) Тогда
				Объект = ТекущиеДанные.ПолучитьОбъект();
				Объект.МаршрутРазвоза = ЗначениеМаршрутРазвоза;
				Объект.Записать();
			КонецЕсли;
		КонецЦикла;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработатьЗаявку(Команда)
	
	ЗначениеМаршрутРазвоза = ОткрытьФормуМодально("Справочник.МаршрутыРазвоза.ФормаВыбора",);
	
	Если ЗначениеМаршрутРазвоза = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	УстановитьМаршрут(Элементы.Список.ВыделенныеСтроки, ЗначениеМаршрутРазвоза);
	
	Элементы.Список.Обновить();
	
КонецПроцедуры

&НаКлиенте
Процедура Печать(команда)
	
	элементОтбораКомпоновкиДанныхМаршрутРазвоза = Неопределено;
	маршрутРазвоза = Неопределено;	
	
	датаОкончания = Элементы.список.Период.ДатаОкончания;
	Если датаОкончания = '0001-01-01' Тогда
		датаОкончания = КонецДня(ТекущаяДата());
	КонецЕсли;
	
	Для Каждого элементОтбора Из список.КомпоновщикНастроек.Настройки.Отбор.Элементы Цикл
		
		Если элементОтбора.ПредставлениеПользовательскойНастройки = "Маршрут развоза" Тогда
			элементОтбораКомпоновкиДанныхМаршрутРазвоза = элементОтбора;
		КонецЕсли;
		
	КонецЦикла;
	
	Если Не элементОтбораКомпоновкиДанныхМаршрутРазвоза = Неопределено Тогда
		элементОтбораПользовательскихНастроек = список.КомпоновщикНастроек.ПользовательскиеНастройки.Элементы.Найти(элементОтбораКомпоновкиДанныхМаршрутРазвоза.ИдентификаторПользовательскойНастройки);
		Если элементОтбораПользовательскихНастроек.Использование Тогда
			маршрутРазвоза = элементОтбораПользовательскихНастроек.ПравоеЗначение;
		КонецЕсли;
	КонецЕсли;
	
	
	условияОтбора = Новый Структура;
	условияОтбора.Вставить("НачалоПериода", НачалоДня(датаОкончания)-7*24*60*60);
	условияОтбора.Вставить("КонецПериода", датаОкончания);
	
	Если Не маршрутРазвоза = Неопределено Тогда
		условияОтбора.Вставить("МаршрутРазвоза", маршрутРазвоза);	
	КонецЕсли;
	
	параметрыФормы = Новый Структура("Отбор, СформироватьПриОткрытии", условияОтбора, Истина);
	
	ОткрытьФорму("Отчет.ВедомостьПоРазвозу.ФормаОбъекта", параметрыФормы);
	
КонецПроцедуры

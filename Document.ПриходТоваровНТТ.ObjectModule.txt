#Область ОбработчикиСобытий

Процедура ОбработкаПроведения(Отказ, РежимПроведения)
	
	// Инициализация дополнительных свойств для проведения документа.
	УправлениеНебольшойФирмойСервер.ИнициализироватьДополнительныеСвойстваДляПроведения(Ссылка, ДополнительныеСвойства);
	
	Движение = Движения.ВзаиморасчетыСПоставщиками.Добавить();
	
	Движение.Период = ЭтотОбъект.Дата;
	Движение.ВидДвижения = ВидДвиженияНакопления.Расход;
	Движение.Контрагент	= ЭтотОбъект.Поставщик;
	Движение.Подразделение	= Подразделение;
	Движение.Сумма = ЭтотОбъект.СуммаДокумента;
	
	
	
	Движение = Движения.ВзаиморасчетыСПокупателями.Добавить();
	
	Движение.Период 		= ЭтотОбъект.Дата;
	Движение.ВидДвижения 	= ВидДвиженияНакопления.Приход;
	Движение.Подразделение	= ЭтотОбъект.Подразделение;
	Движение.Контрагент		= ЭтотОбъект.Отдел.Магазин;
	//Движение.КредитныйДокумент = Ссылка;
	Движение.Менеджер 		= Справочники.Менеджеры.БезМенеджера;
	Движение.Сумма 			= ЭтотОбъект.СуммаДокумента;	
	
	// Регистр "Продажи"
	Движение = Движения.Продажи.Добавить();
	Движение.Период 		= Дата;
	Движение.Подразделение 	= Подразделение;
	Движение.Контрагент 	= Отдел.Магазин;
	Движение.Менеджер 		= Справочники.Менеджеры.БезМенеджера;
	Движение.ПродСтоимость	= СуммаДокумента;
	
	// Допроведем розницу .... ОБЯЗАТЕЛЬНО !!! после выполнения проверки документа
	
	Если НЕ Отдел.Подразделение = Неопределено Тогда
		
		// Партии товаров в рознице
		Движение = Движения.ПартииТоваровНаСкладах.Добавить();
		
		Движение.ВидДвижения 	= ВидДвиженияНакопления.Приход;
		Движение.Период 		= Дата;
		Движение.Подразделение 	= Отдел.Подразделение;
		Движение.Склад 			= Отдел.Склад;
		Движение.ЦФО 			= Отдел;
		Движение.Стоимость 		= СуммаДокумента;
		Движение.ПродСтоимость 	= СуммаБезСкидки;
		
		// Взаиморасчеты с "Поставщиками"
		Движение = Движения.ВзаиморасчетыСПоставщиками.Добавить();
		
		Движение.ВидДвижения 	= ВидДвиженияНакопления.Расход;
		Движение.Период 		= Дата;
		Движение.Подразделение	= Отдел.Подразделение;
		Движение.Контрагент 	= ДополнительныеСвойства.УчетнаяПолитика.Контрагент;
		Движение.ЦФО 			= Отдел;
		Движение.Сумма 			= СуммаДокумента;
		
	КонецЕсли;
		
	Движения.ВзаиморасчетыСПокупателями.Записать();
	Движения.ВзаиморасчетыСПоставщиками.Записать();
	Движения.ПартииТоваровНаСкладах.Записать();
	Движения.Продажи.Записать();
	
КонецПроцедуры

Процедура ПриКопировании(объектКопирования)
	
	ЗаполнениеОбъектовСервер.ЗаполнитьДанныеСкопированногоДокумента(ЭтотОбъект, объектКопирования);
	
КонецПроцедуры

#КонецОбласти 
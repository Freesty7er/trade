
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	АдресНастроекСКД = Параметры.АдресНастроекСКД;
	АдресСКД = ПоместитьВоВременноеХранилище(Документы.БПАГСтандартПрисутствия.ПолучитьМакет("МакетЗаполнитьИсходнуюТаблицуСхема"),ЭтаФорма.УникальныйИдентификатор);
	ГруппаПродукта = Параметры.ГруппаПродукта;
	КатегорийнаяГруппа.ЗагрузитьЗначения(Параметры.КатегорийныеГруппы);
	ПериодЗаполнения = Параметры.ПериодЗаполнения;
	
КонецПроцедуры

&НаКлиенте
Процедура КомпоновщикНастроекИнициализировать()
	
	КомпоновщикНастроек = Новый КомпоновщикНастроекКомпоновкиДанных;
	
	схемаКомпоновкиДанных = ПолучитьИзВременногоХранилища(АдресСКД);
	настройкиСКД = ПолучитьИзВременногоХранилища(АдресНастроекСКД);
	
	КомпоновщикНастроек.Инициализировать(Новый ИсточникДоступныхНастроекКомпоновкиДанных(СхемаКомпоновкиДанных));
	
	Если настройкиСКД = Неопределено Тогда
		
		настройкиСКД = схемаКомпоновкиДанных.НастройкиПоУмолчанию;
		
		отборПродажиПодразделение = настройкиСКД.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		//отборПродажиПодразделение.Представление = "Продажи. Подразделение";
		отборПродажиПодразделение.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("ПродажиПодразделение");
		отборПродажиПодразделение.ВидСравнения = ВидСравненияКомпоновкиДанных.ВСписке;
		отборПродажиПодразделение.Использование = Ложь;
		
		отборПродажиКатегорийнаяГруппа = настройкиСКД.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		//отборПродажиКатегорийнаяГруппа.Представление = "Продажи. Категорийная группа";
		отборПродажиКатегорийнаяГруппа.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("ПродажиКатегорийнаяГруппа");
		отборПродажиКатегорийнаяГруппа.ВидСравнения = ВидСравненияКомпоновкиДанных.ВСписке;
		отборПродажиКатегорийнаяГруппа.ПравоеЗначение = КатегорийнаяГруппа;
		отборПродажиКатегорийнаяГруппа.Использование = Истина;
		
		отборПродажиКатегорияТТ = настройкиСКД.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		//отборПродажиКатегорияТТ.Представление = "Продажи. Категория торговой точки";
		отборПродажиКатегорияТТ.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("ПродажиКатегорияТТ");
		отборПродажиКатегорияТТ.ВидСравнения = ВидСравненияКомпоновкиДанных.Равно;
		отборПродажиКатегорияТТ.Использование = Ложь;
		
		отборПродажиГруппаПродукта = настройкиСКД.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		//отборПродажиГруппаПродукта.Представление = "Продажи. Группа продукта";
		отборПродажиГруппаПродукта.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("ПродажиГруппаПродукта");
		отборПродажиГруппаПродукта.ВидСравнения = ВидСравненияКомпоновкиДанных.ВИерархии;
		отборПродажиГруппаПродукта.ПравоеЗначение = ГруппаПродукта;
		отборПродажиГруппаПродукта.Использование = Истина;
		
		отборПродажиНоменклатура = настройкиСКД.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
		//отборПродажиНоменклатура.Представление = "Продажи. Номенклатура";
		отборПродажиНоменклатура.ЛевоеЗначение = Новый ПолеКомпоновкиДанных("ПродажиНоменклатура");
		отборПродажиНоменклатура.ВидСравнения = ВидСравненияКомпоновкиДанных.ВСпискеПоИерархии;
		отборПродажиНоменклатура.Использование = Ложь;
		
		параметрыПериодЗаполнения = настройкиСКД.ПараметрыДанных.Элементы.Добавить();
		параметрыПериодЗаполнения.Параметр = Новый ПараметрКомпоновкиДанных("ПериодЗаполнения");
		параметрыПериодЗаполнения.Значение = ПериодЗаполнения;
		параметрыПериодЗаполнения.Использование = Истина;
		
	КонецЕсли;
	
	КомпоновщикНастроек.ЗагрузитьНастройки(настройкиСКД);
	КомпоновщикНастроек.Восстановить();
	
КонецПроцедуры

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	КомпоновщикНастроекИнициализировать();
КонецПроцедуры

&НаКлиенте
Процедура ВыполнитьЗаполнение(Команда)
	Оповестить("ЗаполнитьИсходнуюТаблицуНастройки", Новый Структура("АдресНастроекСКД",ПоместитьВоВременноеХранилище(КомпоновщикНастроек.Настройки,ЭтаФорма.УникальныйИдентификатор)));
	Закрыть();
КонецПроцедуры

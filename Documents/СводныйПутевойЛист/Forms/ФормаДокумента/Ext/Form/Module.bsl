
#Область ОбработчикиСобытий

&НаКлиенте
Процедура СоставПоказанияСпидометраВыездПриИзменении(элемент)
	РасчетСтроки();
КонецПроцедуры

&НаКлиенте
Процедура СоставПоказанияСпидометраЗаездПриИзменении(элемент)
	РасчетСтроки();
КонецПроцедуры

&НаКлиенте
Процедура СоставЗаправкаЛитрыПриИзменении(элемент)
	РасчетСтроки();
КонецПроцедуры

&НаКлиенте
Процедура СоставКоличествоТТПриИзменении(элемент)
	РасчетСтроки();
КонецПроцедуры

&НаКлиенте
Процедура СоставВесПриИзменении(элемент)
	РасчетСтроки();
КонецПроцедуры

&НаКлиенте
Процедура СоставЗаправкаТалоныПриИзменении(элемент)
	РасчетСтроки();
КонецПроцедуры

&НаКлиенте
Процедура СоставЭкспедиторПриИзменении(Элемент)
	РасчетСтроки();
КонецПроцедуры

#КонецОбласти

#Область ДополнительныеПроцедурыИФункции

&НаКлиенте
Процедура РасчетСтроки()
	
	строкаТабличнойЧасти = Элементы.Состав.ТекущиеДанные;
	строкаТабличнойЧасти.Пробег = СтрокаТабличнойЧасти.ПоказанияСпидометраЗаезд - СтрокаТабличнойЧасти.ПоказанияСпидометраВыезд;
	
	Если Не строкаТабличнойЧасти.Пробег = 0 Тогда
		строкаТабличнойЧасти.СреднийРасход = (СтрокаТабличнойЧасти.ЗаправкаЛитры + СтрокаТабличнойЧасти.ЗаправкаТалоны) * (100/СтрокаТабличнойЧасти.Пробег);
	Иначе
		строкаТабличнойЧасти.СреднийРасход = 0;
	КонецЕсли;
	
	пробег = строкаТабличнойЧасти.Пробег;
	
	структураТарифа = ПолучитьТарифыПоПодразделениюСервер(Объект.Подразделение, пробег, Объект.Дата); 
	
	// расчет зарплаты
	строкаТабличнойЧасти.СуммаЗарплаты = структураТарифа.ОплатаЗаРейс
				+ строкаТабличнойЧасти.Пробег*структураТарифа.ОплатаЗаКМ
				+ строкаТабличнойЧасти.КоличествоТТ*структураТарифа.ОплатаЗаТРТ
				+ строкаТабличнойЧасти.Вес*структураТарифа.ОплатаЗаВес;
	
							
	// расчет з/п экспедитора
	Если ЗначениеЗаполнено(строкаТабличнойЧасти.Экспедитор) Тогда
		строкаТабличнойЧасти.СуммаЗарплатыЭкспедитора = 250;
	Иначе
		строкаТабличнойЧасти.СуммаЗарплатыЭкспедитора = 0;
	КонецЕсли;
	
КонецПроцедуры

&НаСервереБезКонтекста
Функция ПолучитьТарифыПоПодразделениюСервер(подразделение, пробег, датаСреза)
	Возврат ДокументСводныйПутевойЛистСервер.ПолучитьТарифыПоПодразделению(подразделение, пробег, датаСреза)
Конецфункции

#КонецОбласти




#Область ОбработчикиСобытий

Процедура ОбработкаЗаполнения(данныеЗаполнения, текстЗаполнения, стандартнаяОбработка)
	
	// заполнение по умолчанию
	МаршрутРазвоза = Справочники.МаршрутыРазвоза.ПустойМаршрут;
	Менеджер = Справочники.Менеджеры.БезМенеджера;
	
	Если Подразделение.Пустая() Тогда
		Подразделение = ПользователиСервер.ПолучитьЗначениеНастройки("ОсновноеПодразделение");
	КонецЕсли;
	
	// ввод на основании
	Если ТипЗнч(данныеЗаполнения) = Тип("ДокументСсылка.ЗаказПоставщику") Тогда
	
		// Заполнение реквизитов документа.
		ЗаполнениеОбъектовСервер.ЗаполнитьРеквизитыДокументаПриВводеНаОсновании(ЭтотОбъект, данныеЗаполнения);
		ДокументОснование = данныеЗаполнения;
		
		Комментарий = данныеЗаполнения.НомерЗаказа;
		
		Запасы.Очистить();	// Очистим табличную часть на случай перезаполнения документа.
		Для каждого строкаЗапасы Из данныеЗаполнения.Запасы Цикл
			
			новаяСтрока = Запасы.Добавить();
			ЗаполнитьЗначенияСвойств(новаяСтрока, строкаЗапасы);
			
		КонецЦикла;
		
	КонецЕсли;
	
КонецПроцедуры

Процедура ОбработкаПроведения(отказ, режимПроведения)
	
	//ЗаказыПокупателей = Движения.ЗаказыПокупателей;
	//
	//Для Каждого СтрокаСостава Из Запасы Цикл
	//	
	//	Движение = ЗаказыПокупателей.Добавить();
	//	Движение.Период = Дата;
	//	Движение.Подразделение = Подразделение;
	//	Движение.Контрагент = Контрагент;
	//	Движение.Склад = СтрокаСостава.Номенклатура.Склад;
	//	Движение.Менеджер = Агент.Менеджер;
	//	Движение.Номенклатура = СтрокаСостава.Номенклатура;
	//	Движение.ЗаказПокупателя = Ссылка;
	//	Движение.Заказано = СтрокаСостава.Количество;
	//	
	//КонецЦикла;
	//
	//ЗаказыПокупателей.Записать();
	
КонецПроцедуры

Процедура ПередЗаписью(отказ, режимЗаписи, режимПроведения)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;
	
	Если ПометкаУдаления = Ссылка.ПометкаУдаления Тогда
		
		Если РежимЗаписи <> РежимЗаписиДокумента.ОтменаПроведения Тогда
			
			Если Не Отказ Тогда
				
				СуммаДокумента = ОбщегоНазначенияСервер.ПолучитьСуммуДокумента(ЭтотОбъект, "Запасы");
				
			КонецЕсли; 
			
		КонецЕсли;
		

	КонецЕсли;
	
КонецПроцедуры

Процедура ПриЗаписи(отказ)
	
	Если ОбменДанными.Загрузка Тогда
		Возврат;
	КонецЕсли;

	ПредставлениеКомментария = "";
	
	Если НЕ СокрЛП(НомерЗаказа.Наименование) = "" Тогда
		ПредставлениеКомментария = СокрЛП(НомерЗаказа.Наименование) + " ";
	КонецЕсли;
	
	ПредставлениеКомментария = ПредставлениеКомментария + СокрЛП(Комментарий);
	
КонецПроцедуры

Процедура ПриКопировании(объектКопирования)
	
	ЗаполнениеОбъектовСервер.ЗаполнитьДанныеСкопированногоДокумента(ЭтотОбъект, ОбъектКопирования);
	
КонецПроцедуры

Процедура ОбработкаПроверкиЗаполнения(отказ, проверяемыеРеквизиты)
	
	проверяемыеРеквизиты.Добавить("Запасы.Номенклатура");
	
	Если Подразделение.Пустая() Тогда
		
		текстСообщения = НСтр("ru = 'Запись невозможна без заполнения Подразделения.'");
		ПроверкаДанныхКлиентСервер.СообщитьОбОшибке(отказ, текстСообщения, ЭтотОбъект, "Подразделение");
		
	КонецЕсли;
	
КонецПроцедуры

#КонецОбласти 
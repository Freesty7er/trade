Функция ПолучитьХарактеристикиТовара(номенклатура)

	запрос = Новый Запрос;
	
	#Область ТекстЗапроса
	
	запрос.Текст =
	"ВЫБРАТЬ
	|	Номенклатура.БПАГКратностьУпаковки,
	|	Номенклатура.Ссылка КАК Номенклатура
	|ИЗ
	|	Справочник.Номенклатура КАК Номенклатура
	|ГДЕ
	|	Номенклатура.Ссылка В(&Номенклатура)";
	
	#КонецОбласти
	
	запрос.УстановитьПараметр("Номенклатура", номенклатура);
	
	результат = запрос.Выполнить();
	
	выборка = результат.Выбрать();
	
	соХарактеристики = Новый Соответствие;
	
	Пока выборка.Следующий() Цикл
	
		стХарактеристикиТовара = Новый Структура("БПАГКратностьУпаковки");
		
		ЗаполнитьЗначенияСвойств(стХарактеристикиТовара, выборка);
		
		соХарактеристики.Вставить(выборка.Номенклатура, стХарактеристикиТовара);
	
	КонецЦикла;	
	
	Возврат соХарактеристики;

КонецФункции // ПолучитьХарактеристикиТовара()

Процедура РасчитатьМинимальныйОстаток(объект) Экспорт
	
	наборНоменклатуры = ОбработкаТабличныхЧастейКлиентСервер.ВыгрузитьКолонку(объект.СтандартПрисутствия, "Номенклатура");
	характеристикиТовара = ПолучитьХарактеристикиТовара(наборНоменклатуры);
	
	Для каждого строкаСтандарта Из объект.СтандартПрисутствия Цикл
		
		// считаем только если есть фэйсинг
		Если строкаСтандарта.Фэйсинг <> 0 Тогда
			
			строкаСтандарта.МинимальныйОстаток = строкаСтандарта.Фэйсинг * характеристикиТовара[строкаСтандарта.Номенклатура].БПАГКратностьУпаковки;
			
		КонецЕсли;
		
	КонецЦикла; 
	
КонецПроцедуры

&НаКлиенте
Процедура ДатаРазвозаПриИзменении(Элемент)
	
	Если НЕ ЗначениеЗаполнено(Подразделение) Тогда
		Предупреждение("Выберите подразделение!");
		Возврат;
	КонецЕсли;

	
	//Настройки динамеческих списков
	ОбновитьДанныеФормыНаСервере();
	
КонецПроцедуры

&НаСервере
// Процедура обновляет данные формы "Подбор" на сервере
//
// Условием выполнения служит изменение пользовательских параметров отображения формы либо 
// изменение организации, структурной единицы
//
Процедура ОбновитьДанныеФормыНаСервере(ВыбраннаяГруппаНоменклатуры = Неопределено)

	// Параметры запроса
	УстановитьПараметрДинамическогоСписка(СписокМаршрутов, "НачалоПериода", 		НачалоДня(ДатаРазвоза));
	УстановитьПараметрДинамическогоСписка(СписокМаршрутов, "ОкончаниеПериода",	КонецДня(ДатаРазвоза));
	УстановитьПараметрДинамическогоСписка(СписокМаршрутов, "Подразделение", 		Подразделение);

КонецПроцедуры

&НаСервере
// Устанавливает значение параметра динамического списка на сервере
//
// Параметры:
// ДинамическийСписок - динамический список, для которого устанавливается параметр
// Имя - имя параметра динамического списка
// ЗначениеПараметра - значение устанавливаемого параметра
//
Процедура УстановитьПараметрДинамическогоСписка(ДинамическийСписок, Имя, ЗначениеПараметра)
	
	Если НЕ ДинамическийСписок.Параметры.Элементы.Найти(Имя) = Неопределено Тогда
	
		ДинамическийСписок.Параметры.УстановитьЗначениеПараметра(Имя, ЗначениеПараметра);
		
	КонецЕсли;
	
КонецПроцедуры // УстановитьПараметрДинамическогоСписка()

&НаКлиенте
Процедура ПодразделениеПриИзменении(Элемент)
	
	Если НЕ ЗначениеЗаполнено(Подразделение) Тогда
		Предупреждение("Выберите подразделение!");
		Возврат;
	КонецЕсли;

	
	//Настройки динамеческих списков
	ОбновитьДанныеФормыНаСервере();
	
КонецПроцедуры

&НаСервере
Процедура ПриЗагрузкеДанныхИзНастроекНаСервере(Настройки)
	
	ДатаРазвоза = НачалоДня(ТекущаяДата())-1;
	Подразделение = Настройки.Получить("Подразделение");
	
	Если НЕ ЗначениеЗаполнено(Подразделение) Тогда
		
		Пользователь = Пользователи.ТекущийПользователь();
	    Подразделение = УправлениеНебольшойФирмойПовтИсп.ПолучитьЗначениеПоУмолчаниюПользователя(Пользователь, "ОсновноеПодразделение");
		
	КонецЕсли;
	
	//Настройки динамеческих списков
	ОбновитьДанныеФормыНаСервере();

КонецПроцедуры

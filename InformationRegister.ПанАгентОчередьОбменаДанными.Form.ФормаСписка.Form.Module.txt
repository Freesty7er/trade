#Область КомандыФормы

&НаКлиенте
Процедура СформироватьОчередьОбменаДанными(команда)
	
	СформироватьОчередьОбменаДаннымиНаСервере();
	
	ОповеститьОбИзменении(Тип("РегистрСведенийКлючЗаписи.ПанАгентОчередьОбменаДанными"));
	
КонецПроцедуры

&НаКлиенте
Процедура ВыполнениеОчередиОбменаДанными(команда)
	
	ВыполнитьОчередьОбменаДаннымиНаСервере();
	
	ОповеститьОбИзменении(Тип("РегистрСведенийКлючЗаписи.ПанАгентОчередьОбменаДанными"));
	
КонецПроцедуры

&НаКлиенте
Процедура ВыполнениеОчередиОбменаДаннымиФоноваяЗадача(команда)
	ВыполнениеОчередиОбменаДаннымиФоноваяЗадачаНаСервере();
КонецПроцедуры

#КонецОбласти

#Область ПрочиеПроцедурыИФункции

&НаСервере
Процедура СформироватьОчередьОбменаДаннымиНаСервере()
	РегистрыСведений.ПанАгентОчередьОбменаДанными.СформироватьОчередьОбменаДанными();
КонецПроцедуры

&НаСервере
Процедура ВыполнитьОчередьОбменаДаннымиНаСервере()
	ПанАгентСервер.ВыполнитьОчередьОбменаДанными();
КонецПроцедуры

&НаСервере
Процедура ВыполнениеОчередиОбменаДаннымиФоноваяЗадачаНаСервере()
	
	ключЗадания = Метаданные.РегламентныеЗадания.ПанАгентВыполнениеОчередиОбмена.Ключ;
	активныеФоновыеЗадания = ФоновыеЗадания.ПолучитьФоновыеЗадания(Новый Структура("Ключ,Состояние", ключЗадания, СостояниеФоновогоЗадания.Активно));
	
	Если активныеФоновыеЗадания.Количество() = 0 Тогда
		ФоновыеЗадания.Выполнить("ПанАгентСервер.ВыполнитьОчередьОбменаДанными",, ключЗадания, НСтр("ru = 'Выполнение очереди обмена данными'"));
	КонецЕсли;
	
КонецПроцедуры



#КонецОбласти
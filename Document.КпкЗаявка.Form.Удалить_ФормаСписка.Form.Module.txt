
&НаСервере
Процедура УстановитьМаршрут(Знач ДанныеДляОбработки, ЗначениеМаршрутРазвоза)
	
	//ЗначениеМаршрутРазвоза = Неопределено;
	
	Если ДанныеДляОбработки <> Неопределено Тогда
		
		Для Каждого ТекущиеДанные Из ДанныеДляОбработки Цикл
			Если ЗначениеЗаполнено(ТекущиеДанные) И (НЕ ТекущиеДанные.МаршрутРазвоза = ЗначениеМаршрутРазвоза) Тогда
				Объект = ТекущиеДанные.ПолучитьОбъект();
				Объект.МаршрутРазвоза = ЗначениеМаршрутРазвоза;
				Объект.Записать();
			КонецЕсли;
		КонецЦикла;
		
	КонецЕсли;
	
КонецПроцедуры

&НаКлиенте
Процедура ОбработатьЗаявку(Команда)
	
	ЗначениеМаршрутРазвоза = ОткрытьФормуМодально("Справочник.МаршрутыРазвоза.ФормаВыбора",);
	
	Если ЗначениеМаршрутРазвоза = Неопределено Тогда
		Возврат;
	КонецЕсли;
	
	УстановитьМаршрут(Элементы.Список.ВыделенныеСтроки, ЗначениеМаршрутРазвоза);
	
	Элементы.Список.Обновить();
	
КонецПроцедуры

&НаКлиенте
Процедура Печать(Команда)
	
	ДатаОкончания = Элементы.список.Период.ДатаОкончания;
	Если ДатаОкончания = '0001-01-01' Тогда
		ДатаОкончания = КонецДня(ТекущаяДата());
	КонецЕсли;
	
	УсловияОтбора = Новый Структура("НачалоПериода, КонецПериода", ДатаОкончания-7*24*60*60, ДатаОкончания);
	ПараметрыФормы = Новый Структура("Отбор, СформироватьПриОткрытии", УсловияОтбора, Истина);
	
	ОткрытьФорму("Отчет.ВедомостьПоРазвозу.ФормаОбъекта", ПараметрыФормы);
	
КонецПроцедуры

&НаКлиенте
Процедура ПечатьЗаявки(Команда)
	
	ДатаОкончания = Элементы.список.Период.ДатаОкончания;
	Если ДатаОкончания = '0001-01-01' Тогда
		ДатаОкончания = КонецДня(ТекущаяДата());
	КонецЕсли;
	
	//УсловияОтбора = Новый Структура("НачалоПериода, КонецПериода", НачалоДня(ДатаОкончания), ДатаОкончания);
	//ПараметрыФормы = Новый Структура("Отбор, СформироватьПриОткрытии", УсловияОтбора, Истина);
	ПараметрыФормы = Новый Структура("СформироватьПриОткрытии", Истина);
	
	ОткрытьФорму("Отчет.Заявки.ФормаОбъекта", ПараметрыФормы);

КонецПроцедуры


&НаКлиенте
Процедура ОтборПодразделениеПриИзменении(Элемент)
	
	УправлениеНебольшойФирмойКлиент.ИзменитьЭлементОтбораСписка(Список, "Подразделение", ОтборПодразделение, ЗначениеЗаполнено(ОтборПодразделение));

КонецПроцедуры

&НаКлиенте
Процедура ОтборКонтрагентПриИзменении(Элемент)
 	
	УправлениеНебольшойФирмойКлиент.ИзменитьЭлементОтбораСписка(Список, "Контрагент", ОтборКонтрагент, ЗначениеЗаполнено(ОтборКонтрагент));
	
КонецПроцедуры

&НаКлиенте
Процедура ОтборАгентПриИзменении(Элемент)
	
	УправлениеНебольшойФирмойКлиент.ИзменитьЭлементОтбораСписка(Список, "Агент", ОтборАгент, ЗначениеЗаполнено(ОтборАгент));
	
КонецПроцедуры

&НаСервере
Процедура ПриЗагрузкеДанныхИзНастроекНаСервере(Настройки)
	
	ОтборПодразделение = Настройки.Получить("ОтборПодразделение");
	ОтборКонтрагент = Настройки.Получить("ОтборКонтрагент");
	ОтборАгент = Настройки.Получить("ОтборАгент");
	
	УправлениеНебольшойФирмойСервер.ИзменитьЭлементОтбораСписка(Список, "Подразделение", ОтборПодразделение, ЗначениеЗаполнено(ОтборПодразделение));
	УправлениеНебольшойФирмойСервер.ИзменитьЭлементОтбораСписка(Список, "Контрагент", ОтборКонтрагент, ЗначениеЗаполнено(ОтборКонтрагент));
	УправлениеНебольшойФирмойСервер.ИзменитьЭлементОтбораСписка(Список, "Агент", ОтборАгент, ЗначениеЗаполнено(ОтборАгент));
	
КонецПроцедуры

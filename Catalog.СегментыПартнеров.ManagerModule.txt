#Если Сервер Или ТолстыйКлиентОбычноеПриложение Или ВнешнееСоединение Тогда


////////////////////////////////////////////////////////////////////////////////
// ПРОГРАММНЫЙ ИНТЕРФЕЙС

//Возвращает имена блокруемых реквизитов для механизма блокирования реквизитов БСП
// Возвращаемое значание:
//   Массив - имена блокируемых реквизитов
//
Функция ПолучитьБлокируемыеРеквизитыОбъекта() Экспорт
	
	Результат = Новый Массив;
	
	Результат.Добавить("СпособФормирования");
	Результат.Добавить("РегламентноеЗаданиеИспользуется; РегламентноеЗаданиеАктивно");
	Результат.Добавить("ПредставлениеШаблонаСКД; Настройки");
	Результат.Добавить("Расписание; НастроитьРасписание");
	
	Возврат Результат;
	
КонецФункции

//Возвращает имена реквизитов, которые не должны отображаться в списке реквизитов обработки ГрупповоеИзменениеОбъектов
//
//	Возвращаемое значение:
//		Массив - массив имен реквизитов
//
Функция РеквизитыНеРедактируемыеВГрупповойОбработке() Экспорт
	
	НеРедактируемыеРеквизиты = Новый Массив;
	НеРедактируемыеРеквизиты.Добавить("ПроверятьНаВхождениеПриСозданииНового");
	НеРедактируемыеРеквизиты.Добавить("СхемаКомпоновкиДанных");
	НеРедактируемыеРеквизиты.Добавить("ХранилищеНастроекКомпоновкиДанных");
	НеРедактируемыеРеквизиты.Добавить("РегламентноеЗадание");
	НеРедактируемыеРеквизиты.Добавить("ИмяШаблонаСКД");
	
	Возврат НеРедактируемыеРеквизиты;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

////////////////////////////////////////////////////////////////////////////////
// Обновление информационной базы

// Выполняет заполнение предопределенного элемента при записи
Процедура ЗаполнитьПредопределенныйСегмент() Экспорт
	
	справочникОбъект = Справочники.СегментыПартнеров.ПродажиЗапрещены.ПолучитьОбъект();
	справочникОбъект.СпособФормирования = Перечисления.СпособыФормированияСегментов.ФормироватьВручную;
	справочникОбъект.СхемаКомпоновкиДанных  = Новый ХранилищеЗначения(Справочники.СегментыПартнеров.ПолучитьМакет("ОсновнаяСхема"));
	
	__ПараметрыЗапретаРедактирования = Новый Соответствие;
	__ПараметрыЗапретаРедактирования.Вставить("СпособФормирования",Истина);	 
	
	справочникОбъект.ДополнительныеСвойства.Вставить("__ПараметрыЗапретаРедактирования",__ПараметрыЗапретаРедактирования);
	справочникОбъект.Описание = НСтр("ru = 'С партнерами входящими в данный сегмент запрещено создавать  новые сделки.'");
	справочникОбъект.Записать();
	
КонецПроцедуры

////////////////////////////////////////////////////////////////////////////////
// Прочее

Функция ШаблоныСхемыКомпоновкиДанных() Экспорт
	
	шаблоны = Новый Массив;
	
	Для каждого макет из Метаданные.Справочники.СегментыПартнеров.Макеты Цикл
		
		Если макет.ТипМакета <> Метаданные.СвойстваОбъектов.ТипМакета.СхемаКомпоновкиДанных Тогда
			
			Продолжить;
			
		КонецЕсли;
		
		шаблоны.Добавить(Новый Структура("Имя, Синоним", макет.Имя, макет.Синоним));
		
	КонецЦикла;
	
	Возврат шаблоны;
	
КонецФункции

////////////////////////////////////////////////////////////////////////////////
// СЛУЖЕБНЫЕ ПРОЦЕДУРЫ И ФУНКЦИИ

////////////////////////////////////////////////////////////////////////////////
// Обновление информационной базы

Процедура ПослеЗагрузкиДанныхИзДругойМодели() Экспорт
	
	запрос = Новый Запрос;
	
	#Область ТекстЗапроса
	
	запрос.Текст =
	"ВЫБРАТЬ
	|	СегментыПартнеров.Ссылка,
	|	СегментыПартнеров.ИмяШаблонаСКД
	|ИЗ
	|	Справочник.СегментыПартнеров КАК СегментыПартнеров";
	
	#КонецОбласти 
	
	выборка = запрос.Выполнить().Выбрать();
	
	Пока выборка.Следующий() Цикл
		
		Если ПустаяСтрока(выборка.ИмяШаблонаСКД) Тогда
			
			справочникОбъект = выборка.Ссылка.ПолучитьОбъект();
			справочникОбъект.ХранилищеНастроекКомпоновкиДанных = Новый ХранилищеЗначения("");
			справочникОбъект.СхемаКомпоновкиДанных = Новый ХранилищеЗначения("");
			
			справочникОбъект.Записать();
			
		КонецЕсли;
		
	КонецЦикла;
	
КонецПроцедуры

#КонецЕсли

&НаКлиенте
Процедура КаталогСохраненияФайлаНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
		
	СтандартнаяОбработка = Ложь;
	
	ДиалогВыбораФайла = Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	//ДиалогВыбораФайла.ПолноеИмяФайла = Объект.ПутьФайла;
	
	//ДиалогВыбораФайла.Фильтр = НСтр("ru = 'Текстовые файлы (*.csv)|*.csv'");
	ДиалогВыбораФайла.МножественныйВыбор = Ложь;
	ДиалогВыбораФайла.ПроверятьСуществованиеФайла = Ложь;
	
	ОписаниеОповещения = Новый ОписаниеОповещения("ОбработатьРезультатДиалогаВыбораФайла", ЭтотОбъект);
	ДиалогВыбораФайла.Показать(ОписаниеОповещения);

КонецПроцедуры


&НаКлиенте
Процедура ОбработатьРезультатДиалогаВыбораФайла(ВыбранныеФайлы, ДополнительныеПараметры) Экспорт
	
	Если ВыбранныеФайлы <> Неопределено Тогда
		Объект.КаталогСохраненияФайла = ВыбранныеФайлы[0];
	КонецЕсли; 
	
КонецПроцедуры // ОбработатьРезультатДиалогаВыбораФайла()

&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ПриОткрытииНаСервере();
КонецПроцедуры

&НаСервере
Процедура ПриОткрытииНаСервере()
	ОбновитьШаблон();
КонецПроцедуры

&НаСервере
Процедура ОбновитьШаблон()
	строкаТекстШаблона = "";
	Если ЗначениеЗаполнено(Объект.ШаблонПочтовогоСообщения) Тогда
		строкаТекстШаблона = строкаТекстШаблона + "Отправитель: " + СокрЛП(Объект.ШаблонПочтовогоСообщения.Отправитель) + Символы.ПС;
		строкаТекстШаблона = строкаТекстШаблона + "Тема:        " + СокрЛП(Объект.ШаблонПочтовогоСообщения.Тема) + Символы.ПС;
		строкаТекстШаблона = строкаТекстШаблона + "Сообщение:   " + СокрЛП(Объект.ШаблонПочтовогоСообщения.Сообщение) + Символы.ПС;
	КонецЕсли;
	ОписаниеШаблона = строкаТекстШаблона;	
КонецПроцедуры

&НаКлиенте
Процедура ШаблонПочтовогоСообщенияПриИзменении(Элемент)
	ШаблонПочтовогоСообщенияПриИзмененииНаСервере();
КонецПроцедуры

&НаСервере
Процедура ШаблонПочтовогоСообщенияПриИзмененииНаСервере()
	ОбновитьШаблон();
КонецПроцедуры

&НаСервере
Процедура Команда1ВыполнитьНаСервере()
	
	структураПараметры = Новый Структура;
	структураПараметры.Вставить("НастройкиОтчета", Объект.НастройкаОтчёта);
	структураПараметры.Вставить("ПутьКФайлу", Объект.КаталогСохраненияФайла);
	структураПараметры.Вставить("ИмяФайла", Объект.ИмяФайла);
	структураПараметры.Вставить("ШаблонИнтернетПочтовогоСообщения", Объект.ШаблонПочтовогоСообщения);
	
	Документы.Служба.СформироватьОтправитьОтчетПоНастройке(структураПараметры);
	
КонецПроцедуры

&НаКлиенте
Процедура Команда1Выполнить(Команда)
	Команда1ВыполнитьНаСервере();
КонецПроцедуры


&НаСервере
Функция ВыгрузитьДанныеСервер()
	
	// Заполним таблицы с данными
	Запрос = Новый Запрос(
	"ВЫБРАТЬ
	|	РасходнаяНакладная.Ссылка
	|ИЗ
	|	Документ.РасходнаяНакладная КАК РасходнаяНакладная
	|ГДЕ
	|	РасходнаяНакладная.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	|	И РасходнаяНакладная.Проведен = ИСТИНА
	|	И РасходнаяНакладная.Контрагент В ИЕРАРХИИ(&Отбор_Контрагент)
	|
	|УПОРЯДОЧИТЬ ПО
	|	РасходнаяНакладная.Дата
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РасходнаяНакладнаяЗапасы.Номенклатура.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.РасходнаяНакладная.Запасы КАК РасходнаяНакладнаяЗапасы
	|ГДЕ
	|	РасходнаяНакладнаяЗапасы.Ссылка.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	|	И РасходнаяНакладнаяЗапасы.Ссылка.Проведен = ИСТИНА
	|	И РасходнаяНакладнаяЗапасы.Ссылка.Контрагент В ИЕРАРХИИ(&Отбор_Контрагент)
	|
	|СГРУППИРОВАТЬ ПО
	|	РасходнаяНакладнаяЗапасы.Номенклатура.Ссылка
	|
	|УПОРЯДОЧИТЬ ПО
	|	РасходнаяНакладнаяЗапасы.Номенклатура.Наименование
	|;
	|
	|////////////////////////////////////////////////////////////////////////////////
	|ВЫБРАТЬ
	|	РасходнаяНакладная.Контрагент.Ссылка КАК Ссылка
	|ИЗ
	|	Документ.РасходнаяНакладная КАК РасходнаяНакладная
	|ГДЕ
	|	РасходнаяНакладная.Дата МЕЖДУ &ДатаНачала И &ДатаОкончания
	|	И РасходнаяНакладная.Ссылка.Проведен = ИСТИНА
	|	И РасходнаяНакладная.Ссылка.Контрагент В ИЕРАРХИИ(&Отбор_Контрагент)
	|
	|СГРУППИРОВАТЬ ПО
	|	РасходнаяНакладная.Контрагент.Ссылка
	|
	|УПОРЯДОЧИТЬ ПО
	|	РасходнаяНакладная.Контрагент.Наименование");
	
	Запрос.УстановитьПараметр("ДатаНачала", 		Объект.ПериодВыгрузки.ДатаНачала);
	Запрос.УстановитьПараметр("ДатаОкончания", 		Объект.ПериодВыгрузки.ДатаОкончания);
	Запрос.УстановитьПараметр("Отбор_Контрагент", 	Объект.Отбор_Котрагент);
	
	РезультатЗапроса = Запрос.ВыполнитьПакет();
	
	Объект.РасходныеНакладные.Загрузить(РезультатЗапроса[0].Выгрузить());
	Объект.Номенклатура.Загрузить(РезультатЗапроса[1].Выгрузить());
	Объект.Контрагенты.Загрузить(РезультатЗапроса[2].Выгрузить());
	
	// Сформируем фалы ХМЛ
	Возврат (РеквизитФормыВЗначение("Объект").ВыгрузитьДанныеВ_XML());
	
КонецФункции

&НаКлиенте
Процедура ВыгрузитьДанные(Команда)
	
	Результат = ВыгрузитьДанныеСервер();
	
	НачатьКопированиеФайла(Новый ОписаниеОповещения("ВыгрузитьДанныеЗавершение", ЭтотОбъект), Результат.ПутьИмяАрхива, Объект.КаталогОбмена + "\" + Результат.ИмяАрхива);
	
КонецПроцедуры

&НаКлиенте
Процедура ВыгрузитьДанныеЗавершение(СкопированныйФайл, ДополнительныеПараметры) Экспорт
	
	// переместим файл в локальную папку .....

КонецПроцедуры

&НаКлиенте
Процедура ЗагрузитьДанные(Команда)
	// Вставить содержимое обработчика.
КонецПроцедуры

&НаКлиенте
Процедура ФайлЗагрузкиНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	ДиалогВыбораФайла	=	Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.Открытие);
	
	ДиалогВыбораФайла.Фильтр						= НСтр("ru='Файл обмена (*.zip)|*.zip';uk='Файл обміну (*.zip)|*.zip'");
	ДиалогВыбораФайла.Расширение					= "zip";
	
	СтандартнаяОбработка = Ложь;
	
	ДиалогВыбораФайла.Заголовок						= НСтр("ru='Выберите файл';uk='Виберіть файл'");
	ДиалогВыбораФайла.ПредварительныйПросмотр		= Ложь;
	ДиалогВыбораФайла.ИндексФильтра					= 0;
	//ДиалогВыбораФайла.ПолноеИмяФайла				= Элемент.Заголовок;
	ДиалогВыбораФайла.ПолноеИмяФайла				= Объект.ФайлЗагрузки;
	//ДиалогВыбораФайла.ПроверятьСуществованиеФайла	=	ПроверятьСуществование;
	
	ДиалогВыбораФайла.Показать(Новый ОписаниеОповещения("ФайлЗагрузкиНачалоВыбораЗавершение", ЭтотОбъект, Новый Структура("ДиалогВыбораФайла", ДиалогВыбораФайла)));
	
КонецПроцедуры

&НаКлиенте
Процедура ФайлЗагрузкиНачалоВыбораЗавершение(ВыбранныеФайлы, ДополнительныеПараметры) Экспорт
	
	ДиалогВыбораФайла = ДополнительныеПараметры.ДиалогВыбораФайла;
	
	
	Если (ВыбранныеФайлы <> Неопределено) Тогда
		
		//Элемент.Заголовок = ДиалогВыбораФайла.ПолноеИмяФайла;
		Объект.ФайлЗагрузки = ДиалогВыбораФайла.ПолноеИмяФайла;
		
	КонецЕсли;

КонецПроцедуры

&НаКлиенте
Процедура КаталогОбменаНачалоВыбора(Элемент, ДанныеВыбора, СтандартнаяОбработка)
	
	ДиалогВыбораФайла	=	Новый ДиалогВыбораФайла(РежимДиалогаВыбораФайла.ВыборКаталога);
	
	//ДиалогВыбораФайла.Фильтр						= НСтр("ru='Файл обмена (*.zip)|*.zip';uk='Файл обміну (*.zip)|*.zip'");
	//ДиалогВыбораФайла.Расширение					= "zip";
	
	СтандартнаяОбработка = Ложь;
	
	ДиалогВыбораФайла.Заголовок						= НСтр("ru='Выберите каталог';uk='Виберіть каталог'");
	ДиалогВыбораФайла.ПредварительныйПросмотр		= Ложь;
	ДиалогВыбораФайла.ИндексФильтра					= 0;
	//ДиалогВыбораФайла.ПолноеИмяФайла				= Элемент.Заголовок;
	ДиалогВыбораФайла.Каталог				= Объект.КаталогОбмена;
	//ДиалогВыбораФайла.ПроверятьСуществованиеФайла	=	ПроверятьСуществование;
	
	ДиалогВыбораФайла.Показать(Новый ОписаниеОповещения("КаталогОбменаНачалоВыбораЗавершение", ЭтотОбъект, Новый Структура("ДиалогВыбораФайла", ДиалогВыбораФайла)));
	
	
КонецПроцедуры

&НаКлиенте
Процедура КаталогОбменаНачалоВыбораЗавершение(ВыбранныеФайлы, ДополнительныеПараметры) Экспорт
	
	ДиалогВыбораФайла = ДополнительныеПараметры.ДиалогВыбораФайла;
	
	
	Если (ВыбранныеФайлы <> Неопределено) Тогда
		
		//Элемент.Заголовок = ДиалогВыбораФайла.ПолноеИмяФайла;
		Объект.КаталогОбмена = ДиалогВыбораФайла.Каталог;
		
	КонецЕсли;
	
КонецПроцедуры


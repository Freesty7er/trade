
&НаКлиенте
Процедура ПриОткрытии(Отказ)
	ЭтаФорма.АвтоЗаголовок = Ложь;
	
	Если Не Агент.Пустая() Тогда
		ЭтаФорма.Заголовок = "Настройки агента " + Агент;
	ИначеЕсли Не Профиль.Пустая() Тогда
		ЭтаФорма.Заголовок = "Настройки профиля """ + Профиль + """";
	Иначе
		ЭтаФорма.Заголовок = "Общие настройки по всем агентам";
	КонецЕсли;
	
	СформироватьСписокНастроекДокументов();
	
КонецПроцедуры

Процедура СформироватьСписокНастроекДокументов()
	
    Если Агент.Пустая() Тогда 
        ДеревоНастроек.Отбор.Элементы.Очистить();
    Иначе
        ДеревоНастроек.Отбор.Элементы.Очистить();
        
        ЭлементыОтбора = ДеревоНастроек.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
        ЭлементыОтбора.ЛевоеЗначение     = Новый ПолеКомпоновкиДанных("Агент");
        ЭлементыОтбора.ВидСравнения     = ВидСравненияКомпоновкиДанных.Равно;
        ЭлементыОтбора.ПравоеЗначение     = Агент;
        ЭлементыОтбора.Использование    = Истина;
		
		Если НЕ Профиль.Пустая() Тогда
	        ЭлементыОтбора = ДеревоНастроек.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
	        ЭлементыОтбора.ЛевоеЗначение     = Новый ПолеКомпоновкиДанных("Профиль");
	        ЭлементыОтбора.ВидСравнения     = ВидСравненияКомпоновкиДанных.Равно;
	        ЭлементыОтбора.ПравоеЗначение     = Профиль;
	        ЭлементыОтбора.Использование    = Истина;
		КонецЕсли;	
    КонецЕсли;	
	
    Если (Агент.Пустая()) и (НЕ  Профиль.Пустая()) Тогда 
        ДеревоНастроек.Отбор.Элементы.Очистить();
        
        ЭлементыОтбора = ДеревоНастроек.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
        ЭлементыОтбора.ЛевоеЗначение     = Новый ПолеКомпоновкиДанных("Профиль");
        ЭлементыОтбора.ВидСравнения     = ВидСравненияКомпоновкиДанных.Равно;
        ЭлементыОтбора.ПравоеЗначение     = Профиль;
        ЭлементыОтбора.Использование    = Истина;
	КонецЕсли;
	
    Если (Агент.Пустая()) и (Профиль.Пустая()) Тогда 
        ДеревоНастроек.Отбор.Элементы.Очистить();
		
        ЭлементыОтбора = ДеревоНастроек.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
        ЭлементыОтбора.ЛевоеЗначение     = Новый ПолеКомпоновкиДанных("Агент");
        ЭлементыОтбора.ВидСравнения     = ВидСравненияКомпоновкиДанных.Равно;
        ЭлементыОтбора.ПравоеЗначение     = Справочники.БПАГАгенты.ПустаяСсылка();
        ЭлементыОтбора.Использование    = Истина;
		
        ЭлементыОтбора = ДеревоНастроек.Отбор.Элементы.Добавить(Тип("ЭлементОтбораКомпоновкиДанных"));
        ЭлементыОтбора.ЛевоеЗначение     = Новый ПолеКомпоновкиДанных("Профиль");
        ЭлементыОтбора.ВидСравнения     = ВидСравненияКомпоновкиДанных.Равно;
        ЭлементыОтбора.ПравоеЗначение     = Справочники.БПАГПрофилиАгентов.ПустаяСсылка();
        ЭлементыОтбора.Использование    = Истина;
	КонецЕсли;
	
КонецПроцедуры

&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Если Параметры.Свойство("Агент") Тогда
		Агент = Параметры.Агент;
		ЭтаФорма.Заголовок = "Настройки агента """ + Агент + """";
	КонецЕсли;
	
	Если Параметры.Свойство("Профиль") Тогда
		Профиль = Параметры.Профиль;
		ЭтаФорма.Заголовок = "Настройки профиля агентов """ + Профиль + """";
	КонецЕсли;
	
КонецПроцедуры

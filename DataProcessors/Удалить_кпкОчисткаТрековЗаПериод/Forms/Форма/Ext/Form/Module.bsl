
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	
	Объект.НачПериода = НачалоДня(ТекущаяДата());
	Объект.КонПериода = КонецДня(ТекущаяДата());
	
	ЗаполнитьТаблицуАгентов();
	
КонецПроцедуры
 
&НаКлиенте
Процедура Заполнить(Команда)
	
	ЗаполнитьТаблицуАгентов();	
	
КонецПроцедуры


&НаКлиенте
Процедура УстановитьИнтервал(Команда)
	
	Диалог = Новый ДиалогРедактированияСтандартногоПериода();
	
	Диалог.Период.ДатаНачала    = Объект.НачПериода;
	Диалог.Период.ДатаОкончания = Объект.КонПериода;
	
	Если Диалог.Редактировать() Тогда
		
		Объект.НачПериода    = Диалог.Период.ДатаНачала;
		Объект.КонПериода = Диалог.Период.ДатаОкончания;
	
	КонецЕсли;
	
КонецПроцедуры


&НаКлиенте
Процедура УстановитьПометки(Команда)
	
	Для Каждого СтрокаТаб Из Объект.ТаблицаАгентов Цикл
		СтрокаТаб.Пометка = Истина;
	КонецЦИкла;
	
КонецПроцедуры


&НаКлиенте
Процедура СнытьПометки(Команда)
	
	Для Каждого СтрокаТаб Из Объект.ТаблицаАгентов Цикл
		СтрокаТаб.Пометка = Ложь;
	КонецЦИкла;
	
КонецПроцедуры

 &НаСервере
Процедура ЗаполнитьТаблицуАгентов()	
	
	Обработка = РеквизитФормыВЗначение("Объект");
	Обработка.ЗаполнитьТаблицуАгентов();
	ЗначениеВРеквизитФормы(Обработка, "Объект");
	
КонецПроцедуры


&НаСервере
Процедура ВыполнитьОчисткуТреков()
	
	РеквизитФормыВЗначение("Объект").ВыполнитьОчисткуТреков();
	
КонецПроцедуры

&НаКлиенте
Процедура ВыполнитьОчистку(Команда)
	
	Сч = 0;
	Для Каждого СтрокаТаб Из Объект.ТаблицаАгентов Цикл
		Если СтрокаТаб.Пометка Тогда
			Сч = Сч + 1;
		КонецЕсли;
	КонецЦИкла;
	
	Если Сч = 0 Тогда
		Сообщить("Не отмечено ни одного агента!", СтатусСообщения.Внимание);
		Возврат; 
	КонецЕсли;
	
	Сообщить("Выполняется очистка треков перемещений за период " + ПредставлениеПериода(НачалоДня(Объект.НачПериода), КонецДня(Объект.КонПериода)));
	
	ВыполнитьОчисткуТреков();
		
	Сообщить("Очистка треков выполнена успешно!", СтатусСообщения.Информация);
		
	
КонецПроцедуры


